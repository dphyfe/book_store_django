{% extends 'bookstore/base.html' %}
{% load static %}

{% block title %}Checkout - Burt's Bookshelf{% endblock %}

{% block hero %}
<section class="page-header bg-light py-4">
    <div class="container">
        <h1 class="display-5 fw-bold">Checkout</h1>
        <p class="lead">Complete your order</p>
    </div>
</section>
{% endblock %}

{% block content %}
<section class="checkout-section py-5">
    <div class="container">
        <div class="row">
            <!-- Order Form -->
            <div class="col-lg-7 mb-4">
                <div class="checkout-form bg-dark p-4 rounded">
                    <h2 class="h3 text-white mb-4">Order Information</h2>

                    <form method="post" id="checkoutForm">
                        {% csrf_token %}

                        <!-- Customer Information -->
                        <div class="mb-4">
                            <h3 class="h5 text-warning mb-3">Contact Information</h3>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="first_name" class="form-label text-light">First Name *</label>
                                    <input type="text" class="form-control" id="first_name" name="first_name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="last_name" class="form-label text-light">Last Name *</label>
                                    <input type="text" class="form-control" id="last_name" name="last_name" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label text-light">Email *</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="phone" class="form-label text-light">Phone Number *</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" required>
                                </div>
                            </div>
                        </div>

                        <!-- Delivery Method -->
                        <div class="mb-4">
                            <h3 class="h5 text-warning mb-3">Delivery Method *</h3>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="delivery_method" id="delivery" value="delivery" required>
                                <label class="form-check-label text-light" for="delivery">
                                    <i class="bi bi-truck"></i> Home Delivery
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="delivery_method" id="pickup" value="pickup" required>
                                <label class="form-check-label text-light" for="pickup">
                                    <i class="bi bi-shop"></i> Store Pickup
                                </label>
                            </div>
                        </div>

                        <!-- Delivery Address (shown only for delivery) -->
                        <div id="deliveryAddress" style="display: none;">
                            <h3 class="h5 text-warning mb-3">Delivery Address</h3>
                            <div class="mb-3">
                                <label for="address" class="form-label text-light">Street Address *</label>
                                <input type="text" class="form-control" id="address" name="address">
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="city" class="form-label text-light">City *</label>
                                    <input type="text" class="form-control" id="city" name="city">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="state" class="form-label text-light">State *</label>
                                    <input type="text" class="form-control" id="state" name="state">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="zip_code" class="form-label text-light">ZIP Code *</label>
                                    <input type="text" class="form-control" id="zip_code" name="zip_code">
                                </div>
                            </div>
                        </div>

                        <!-- Store Pickup Info (shown only for pickup) -->
                        <div id="pickupInfo" class="alert alert-info" style="display: none;">
                            <i class="bi bi-info-circle"></i> <strong>Store Location:</strong><br>
                            Burt's Bookshelf<br>
                            123 Book Street<br>
                            Reading City, RC 12345<br>
                            Hours: Mon-Sat 9AM-8PM, Sun 10AM-6PM
                        </div>

                        <!-- Order Notes -->
                        <div class="mb-4">
                            <label for="notes" class="form-label text-light">Order Notes (Optional)</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Any special instructions..."></textarea>
                        </div>

                        <button type="submit" class="btn btn-checkout btn-lg w-100">
                            <i class="bi bi-check-circle"></i> Place Order
                        </button>
                    </form>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-5">
                <div class="order-summary bg-dark p-4 rounded">
                    <h2 class="h3 text-white mb-4">Order Summary</h2>

                    {% if cart_items %}
                    <div class="order-items mb-4">
                        {% for item in cart_items %}
                        <div class="order-item d-flex mb-3 pb-3 border-bottom border-secondary">
                            <div class="flex-shrink-0 me-3">
                                {% if item.book.cover_image %}
                                <img src="{{ item.book.cover_image }}" alt="{{ item.book.title }}" class="img-thumbnail" style="width: 60px; height: 80px; object-fit: cover;">
                                {% else %}
                                <div class="bg-secondary d-flex align-items-center justify-content-center" style="width: 60px; height: 80px;">
                                    <i class="bi bi-book text-white"></i>
                                </div>
                                {% endif %}
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="text-white mb-1">{{ item.book.title }}</h6>
                                <p class="text-muted small mb-1">by {{ item.book.author }}</p>
                                <p class="text-light mb-0">Qty: {{ item.quantity }} Ã— ${{ item.book.price }}</p>
                            </div>
                            <div class="text-end">
                                <p class="text-info fw-bold mb-0">${{ item.subtotal }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="order-total pt-3 border-top border-secondary">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-light">Subtotal:</span>
                            <span class="text-white">${{ total_price }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-light">Tax:</span>
                            <span class="text-white">$0.00</span>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span class="text-light">Shipping:</span>
                            <span class="text-white" id="shippingCost">TBD</span>
                        </div>
                        <div class="d-flex justify-content-between pt-3 border-top border-secondary">
                            <span class="h5 text-warning mb-0">Total:</span>
                            <span class="h5 text-warning mb-0">${{ total_price }}</span>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-center text-muted">Your cart is empty</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const deliveryRadio = document.getElementById('delivery');
        const pickupRadio = document.getElementById('pickup');
        const deliveryAddress = document.getElementById('deliveryAddress');
        const pickupInfo = document.getElementById('pickupInfo');
        const shippingCost = document.getElementById('shippingCost');

        const addressFields = ['address', 'city', 'state', 'zip_code'];

        function updateDeliveryMethod() {
            if (deliveryRadio.checked) {
                deliveryAddress.style.display = 'block';
                pickupInfo.style.display = 'none';
                shippingCost.textContent = '$5.99';
                addressFields.forEach(field => {
                    document.getElementById(field).required = true;
                });
            } else if (pickupRadio.checked) {
                deliveryAddress.style.display = 'none';
                pickupInfo.style.display = 'block';
                shippingCost.textContent = 'FREE';
                addressFields.forEach(field => {
                    document.getElementById(field).required = false;
                });
            }
        }

        deliveryRadio.addEventListener('change', updateDeliveryMethod);
        pickupRadio.addEventListener('change', updateDeliveryMethod);
    });
</script>
{% endblock %}